{% extends "base.html" %}
{% block title %}Track Order{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4">
        <i class="bi bi-truck me-2" aria-hidden="true"></i>Track Your Order
    </h2>

    {% if order %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            Order #{{ order.order_number }} — Placed on {{ order.order_date.strftime('%B %d, %Y') }}
        </div>
        <div class="card-body">
            <h5 class="card-title">Shipment Status: 
                <span class="badge bg-{{ 'success' if order.status.name == 'DELIVERED' else 'warning' }}">
                    {{ order.status.value }}
                </span>
            </h5>
            <p class="card-text">
                <strong>Estimated Delivery:</strong> 
                {{ order.estimated_delivery.strftime('%B %d, %Y') if order.estimated_delivery else 'TBD' }}<br>
                <strong>Shipping Address:</strong> {{ order.shipping_address }}<br>
                <strong>Carrier:</strong> {{ order.shipping_carrier or 'TBD' }}<br>
                <strong>Tracking Number:</strong> {{ order.tracking_number or 'Unavailable' }}
            </p>

            {% if order.tracking_url %}
                <a href="{{ order.tracking_url }}" target="_blank" class="btn btn-outline-primary">
                    Track with Carrier
                </a>
            {% endif %}
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <strong>Order Items</strong>
        </div>
        <ul class="list-group list-group-flush">
            {% for item in order.items %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ item.product.name }}</strong><br>
                    Quantity: {{ item.quantity }} × {{ item.unit_price | format_currency }}
                </div>
                <span>{{ (item.unit_price * item.quantity) | format_currency }}</span>
            </li>
            {% endfor %}
        </ul>
        <div class="card-footer text-end">
            <strong>Total:</strong> {{ order.total_amount | format_currency }}
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning">
        Order not found or you are not authorized to view it.
    </div>
    {% endif %}
</div>
{% endblock %}
