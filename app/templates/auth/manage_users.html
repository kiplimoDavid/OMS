{% extends "base.html" %}
{% block title %}Manage Users{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">User Management</h1>

  <form method="POST" action="{{ url_for('auth.bulk_delete_users') }}">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for user in users %}
      <div class="col">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="form-check float-end">
              <input class="form-check-input" type="checkbox" name="user_ids" value="{{ user.id }}" id="user-{{ user.id }}">
            </div>
            <h5 class="card-title">{{ user.username }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">{{ user.email }}</h6>

            <p class="card-text mt-2">
              <strong>Status:</strong>
              {% if user.is_deleted %}
                <span class="badge bg-danger">Archived</span>
              {% else %}
                <span class="badge bg-success">Active</span>
              {% endif %}
              <br>
              <strong>Activation:</strong>
              {% if user.is_active_user %}
                <span class="text-success">Enabled</span>
              {% else %}
                <span class="text-danger">Disabled</span>
              {% endif %}
            </p>

            <div class="d-flex justify-content-between">
              <form action="{{ url_for('auth.toggle_active', user_id=user.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-outline-secondary">
                  {{ 'Deactivate' if user.is_active_user else 'Activate' }}
                </button>
              </form>

              <form action="{{ url_for('auth.delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Archive this user?')">
                  Archive
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="mt-4">
      <input type="checkbox" id="select-all" class="form-check-input me-2">
      <label for="select-all" class="form-check-label me-3">Select All</label>
      <button type="submit" class="btn btn-warning" onclick="return confirm('Archive selected users?')">Bulk Archive</button>
    </div>
  </form>

  <hr class="my-5">

  <h2>Add New User</h2>
  <form method="POST" action="{{ url_for('auth.manage_users') }}">
    {{ form.hidden_tag() }}
    <div class="mb-3">
      {{ form.username.label(class="form-label") }}
      {{ form.username(class="form-control") }}
    </div>
    <div class="mb-3">
      {{ form.email.label(class="form-label") }}
      {{ form.email(class="form-control") }}
    </div>
    <div class="mb-3">
      {{ form.password.label(class="form-label") }}
      {{ form.password(class="form-control") }}
    </div>
    <button type="submit" class="btn btn-primary">{{ form.submit.label.text }}</button>
  </form>
</div>

<script>
  document.getElementById('select-all').addEventListener('change', function() {
    document.querySelectorAll('input[name="user_ids"]').forEach(cb => cb.checked = this.checked);
  });
</script>
{% endblock %}
