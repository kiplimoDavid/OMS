{% extends 'base.html' %}

{% block content %}
<h2>{{ title }}</h2>

<form method="POST" action="{{ url_for('customers.add_payment_method') }}">
    {{ form.hidden_tag() }}

    <!-- Payment Method Type -->
    <div class="form-group">
        <label for="method_type ">Payment Method</label>
        {{ form.method_type(class="form-control", id="method_type") }}
    </div>

    <!-- Card Fields -->
    <div id="card-fields" style="display:none;">
        <div class="form-group">
            <label for="card_number">Card Number</label>
            {{ form.card_number(class="form-control", id="card_number") }}
        </div>

        <div class="form-group">
            <label for="expiration_date">Expiration Date</label>
            {{ form.expiration_date(class="form-control", id="expiration_date", type="month") }}
        </div>

        <div class="form-group">
            <label for="cardholder_name">Cardholder Name</label>
            {{ form.cardholder_name(class="form-control", id="cardholder_name") }}
        </div>
    </div>

    <!-- PayPal Fields -->
    <div id="paypal-fields" style="display:none;">
        <div class="form-group">
            <label for="paypal_email">PayPal Email</label>
            {{ form.paypal_email(class="form-control", id="paypal_email") }}
        </div>
    </div>

    <!-- M-Pesa Fields -->
    <div id="mpesa-fields" style="display:none;">
        <div class="form-group">
            <label for="mpesa_number">M-Pesa Phone Number</label>
            {{ form.mpesa_number(class="form-control", id="mpesa_number") }}
        </div>
    </div>

    <!-- Bank Deposit Fields -->
    <div id="bank-fields" style="display:none;">
        <div class="form-group">
            <label for="bank_account">Bank Account Number</label>
            {{ form.bank_account(class="form-control", id="bank_account") }}
        </div>
    </div>

    <!-- Default Option -->
    <div class="form-check mt-3">
        {{ form.is_default(class="form-check-input", id="is_default") }}
        <label class="form-check-label" for="is_default">
            Set as Default Payment Method
        </label>
    </div>

    <!-- Submit -->
    <div class="form-group mt-3">
        {{ form.submit(class="btn btn-primary") }}
    </div>

    <p class="mt-3">
        <a href="{{ url_for('customers.view_customer', customer_id=current_user.id) }}">
            Back to Dashboard
        </a>
    </p>
</form>

<script>
    document.getElementById("method_type").addEventListener("change", function () {
        document.getElementById("card-fields").style.display = "none";
        document.getElementById("paypal-fields").style.display = "none";
        document.getElementById("mpesa-fields").style.display = "none";
        document.getElementById("bank-fields").style.display = "none";

        let val = this.value;
        if (val === "CARD") {
            document.getElementById("card-fields").style.display = "block";
        } else if (val === "PAYPAL") {
            document.getElementById("paypal-fields").style.display = "block";
        } else if (val === "MPESA") {
            document.getElementById("mpesa-fields").style.display = "block";
        } else if (val === "BANK") {
            document.getElementById("bank-fields").style.display = "block";
        }
    });
</script>
{% endblock %}
